<header
    class="sticky top-0 z-40 backdrop-blur bg-slate-900/70 border-b border-slate-700/70 px-4 sm:px-5 py-3 flex flex-wrap items-center gap-4 sm:gap-8 shadow-sm">
    <div class="font-semibold tracking-wide text-sm text-slate-100 shrink-0">Travel Expense Tracker</div>
    <nav class="flex flex-wrap gap-3 sm:gap-5 text-sm text-slate-300">
        {% set path = request.url.path %}
        {% macro nav_link(url, label) -%}
        <a href="{{ url }}"
            class="relative px-1 py-0.5 transition-colors {{ 'text-white' if path == url else 'hover:text-white' }}">
            <span>{{ label }}</span>
            {% if path == url %}<span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded bg-blue-500"></span>{%
            endif %}
        </a>
        {%- endmacro %}
        {{ nav_link('/ui', 'Home') }}
        {{ nav_link('/ui/expenses', 'Expenses') }}
        {{ nav_link('/ui/alerts', 'Alerts') }}
        {{ nav_link('/ui/budgets', 'Budgets') }}
        {{ nav_link('/ui/forex', 'Forex') }}
        {{ nav_link('/ui/settings', 'Settings') }}
    </nav>
    <div class="flex-1"></div>
    <div class="flex items-center gap-2 sm:gap-3 mt-2 sm:mt-0 flex-wrap justify-end">
        {% if trip_options %}
        <form method="post" action="/ui/trips/select"
            class="flex items-center gap-2 bg-slate-800/70 border border-slate-700/80 rounded px-2 py-1 text-[11px] text-slate-200">
            <input type="hidden" name="next_url"
                value="{{ request.url.path }}{% if request.url.query %}?{{ request.url.query }}{% endif %}" />
            <label for="nav-trip-select" class="font-semibold uppercase tracking-wide">Trip</label>
            <select id="nav-trip-select" name="trip_id"
                class="bg-transparent text-xs text-slate-100 focus:outline-none focus:ring-0">
                {% for trip in trip_options %}
                <option value="{{ trip.id }}" {% if active_trip_id == trip.id %}selected{% endif %}>
                    {{ trip.name }}{% if trip.status == 'archived' %} (Archived){% endif %}
                </option>
                {% endfor %}
            </select>
            <button
                class="text-xs font-semibold text-blue-300 hover:text-blue-200 transition-colors">Switch</button>
        </form>
        {% if active_trip %}
        <div class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-slate-100 shadow bg-slate-800/80 border border-slate-700/70"
            title="Active trip">
            <span class="w-1.5 h-1.5 rounded-full {{ 'bg-green-400' if active_trip.status == 'active' else 'bg-slate-400' }}"></span>
            {{ active_trip.name }}
        </div>
        {% endif %}
        {% endif %}
        {% if alerts_count and alerts_count > 0 %}
        <div class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-white shadow bg-red-600"
            title="Active alerts">
            <span class="w-1.5 h-1.5 rounded-full bg-white/70 animate-pulse"></span>
            {{ alerts_count }} alert{{ '' if alerts_count == 1 else 's' }}
        </div>
        {% endif %}
        {% if current_phase %}
        <div class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-white shadow {{ 'bg-amber-600' if current_phase == 'pre-trip' else 'bg-blue-600' }}"
            title="Current phase derived from trip dates">
            <span class="w-1.5 h-1.5 rounded-full bg-white/70 animate-pulse"></span>
            {{ current_phase | replace('-', ' ') }}
        </div>
        {% endif %}
    </div>
</header>
