{% extends 'base.html' %}
{% import 'partials/_components.html' as c %}

{% block title %}Budgets · Travel Expense Tracker{% endblock %}

{% block content %}
{% set trip = active_trip %}
<div class="flex flex-wrap items-start justify-between gap-4 mb-6">
    <div class="space-y-1">
        <h1 class="text-xl font-semibold">Budgets</h1>
        <p class="text-slate-400 text-sm">
            {% if trip %}
            Tracking spend caps for <span class="text-slate-200 font-semibold">{{ trip.name }}</span>
            {% else %}
            Configured currency budgets with threshold indicators.
            {% endif %}
        </p>
    </div>
    {% if trip %}
    <div class="bg-slate-800/80 border border-slate-700/70 rounded-lg px-4 py-3 text-xs sm:text-sm text-slate-200 shadow-sm min-w-[220px]">
        <div class="uppercase tracking-wide text-[11px] text-slate-400">Trip Window</div>
        <div class="mt-1 text-slate-100">{{ trip.start_date or 'Not set' }} -> {{ trip.end_date or 'Not set' }}</div>
        <div class="mt-3 uppercase tracking-wide text-[11px] text-slate-400">Budgets</div>
        <div class="text-slate-100">{{ total_budgets }}</div>
    </div>
    {% endif %}
</div>

<section class="bg-slate-800/70 rounded-lg p-4 shadow-sm border border-slate-700/60 mb-8">
    <h2 class="text-[0.75rem] font-semibold uppercase tracking-wide text-slate-300 mb-3">Summary</h2>
    {% if total_budgets > 0 %}
    <div class="flex flex-wrap gap-4 text-[11px] text-slate-300">
        <div><span class="font-semibold">Total:</span> {{ total_budgets }}</div>
        <div class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-amber-500"></span> >=80%: {{
            warn_budgets|length }}</div>
        <div class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> >=90%: {{
            danger_budgets|length }}</div>
    </div>
    {% else %}
    <p class="text-[11px] text-slate-500">No budgets set yet for this trip. Use the API or automation to configure caps.</p>
    {% endif %}
</section>

<section class="mb-10">
    <h2 class="text-[0.75rem] font-semibold uppercase tracking-wide text-slate-300 mb-3">Details</h2>
    {% if budgets %}
    {% for b in budgets %}
    {{ c.progress_bar(b.percent_used, b.currency ~ ' • ₹' ~ '%.2f'|format(b.spent_amount) ~ ' / ' ~ '%.2f'|format(b.max_amount), warn=b.eighty and not
    b.ninety, danger=b.ninety) }}
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-[10px] text-slate-400 mb-5 pl-1">
        <div><span class="text-slate-300">Remaining:</span> ₹ {{ '%.2f'|format(b.remaining) }}</div>
        <div><span class="text-slate-300">Used:</span> {{ '%.2f' % b.percent_used }}%</div>
        <div><span class="text-slate-300">80% Flag:</span> {{ 'Yes' if b.eighty else 'No' }}</div>
        <div><span class="text-slate-300">90% Flag:</span> {{ 'Yes' if b.ninety else 'No' }}</div>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-[11px] text-slate-500">No budgets to show for this trip.</p>
    {% endif %}
</section>

<section class="bg-slate-800/70 rounded-lg p-4 shadow-sm border border-slate-700/60">
    <h2 class="text-[0.75rem] font-semibold uppercase tracking-wide text-slate-300 mb-3">Legend</h2>
    <ul class="list-disc ml-5 text-[11px] text-slate-400 space-y-1">
        <li><span class="text-slate-300 font-medium">Blue bar</span>: Under 80% usage.</li>
        <li><span class="text-amber-400 font-medium">Amber bar</span>: >=80% and <90% usage.</li>
        <li><span class="text-red-400 font-medium">Red bar</span>: >=90% usage (critical).</li>
    </ul>
</section>

{% endblock %}
